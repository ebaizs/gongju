# 代码混淆与格式化技术研究

## 代码混淆技术实现

### 1. 代码类型自动检测
**检测算法**：
- HTML检测：查找`<html>`, `<body>`, `<div>`等标签
- CSS检测：查找`{`, `}`, `:`，样式属性和选择器
- JS检测：查找`function`, `var`, `let`, `const`, `=>`等关键字
- 混合代码：同时存在多种特征时标记为混合类型

### 2. 混淆核心功能
**移除注释**：
- JS注释：移除`//`单行注释和`/* */`多行注释
- CSS注释：移除`/* */`注释
- HTML注释：移除`<!-- -->`注释
- 保留条件注释和重要的版权信息

**压缩空白**：
- 移除多余空格、制表符、换行符
- 保留必要的空格（如`var a = b`中的赋值空格）
- CSS中保留选择器之间的空格

**变量重命名**：
- 识别局部变量和全局变量
- 使用短名称替换（a, b, c等）
- 保留外部API调用的变量名
- 避免关键字冲突

**字符串编码**：
- 使用Unicode编码或十六进制编码
- 保留必要的字符串（如JSON键名）
- 支持多种编码方式切换

### 3. HTML混合代码处理
**代码分离**：
- 提取`<script>`标签内的JS代码
- 提取`<style>`标签和`style`属性内的CSS
- 分别混淆后重新组装
- 保持标签结构和属性完整性

## 代码格式化技术实现

### 1. 智能格式化
**HTML格式化**：
- 标签缩进和对齐
- 属性换行和排序
- 保留自闭合标签格式
- 处理内联JS和CSS

**JS格式化**：
- 函数和代码块缩进
- 运算符周围添加空格
- 分号自动补全
- 括号匹配检查

**CSS格式化**：
- 选择器和声明缩进
- 属性排序（按字母或重要性）
- 冒号和分号格式化
- 媒体查询嵌进

### 2. 错误修复
**符号修复**：
- 括号匹配检查和补全
- 分号自动补全
- 引号匹配修复
- 标签闭合检查

**语法检查**：
- 基本的语法结构验证
- 常见错误模式识别
- 提供修复建议

### 3. 文件拆分功能
**代码块识别**：
- 识别`<script>`和`<style>`标签
- 提取内联事件处理器
- 识别外部文件引用

**文件生成**：
- 生成独立的HTML、CSS、JS文件
- 添加必要的引用链接
- 创建全局变量和函数调用
- 保证文件间正确引用

**全局变量管理**：
- 识别跨文件调用的变量
- 创建命名空间对象
- 添加必要的导出和导入语句

## AI编程关键词库

### 常用指令模板
- "用替换法告诉我怎么改：将XXX替换为YYY"
- "拆除这段代码，按功能模块分离"
- "增加全局变量，使函数间可以共享数据"
- "优化这段代码的性能和可读性"
- "添加错误处理和边界检查"
- "重构为面向对象/函数式编程风格"
- "添加单元测试用例"
- "转换为异步/await语法"
- "实现缓存机制提升性能"
- "添加类型检查和接口定义"